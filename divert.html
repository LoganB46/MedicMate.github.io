<!DOCTYPE html>
 <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width-device-width, initial-scare=1">
        <title>Hospital Diversion Status</title>
        <link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/divert.css" rel="stylesheet"/>
        <script src="js/bootstrap.bundle.js"></script>
    </head>

    <body>
        <div id="header">
            <header>
                <div class="container">
                    <div class="row">
                     <div class="col-xxlg-6">
                         <div id="header">
                          <h1>Medic Mate</h1>
                          </div>
                         </div>
                    </div>
            </header>
            </div>
            <div class="container">
                <div class="row">
            <ul class="nav justify-content-center">
                <ul class="nav nav-tabs">
                    <li class="nav item">
                        <a class="nav-link"
                        href="index.html">Home</a>
                    </li>
                    <li class="nav item">
                        <a class="nav-link"
                        href="calculators.html">Calculators</a>
                    </li>
                    <li class="nav item">
                <a class="nav-link"
                href="directory.html">Hospital Directory</a>
                 </li>
            <li class="nav item">
                <a class="nav-link"
                href="about.html">About Us</a>
            </li>
                    </ul>   
                </ul>
             </div>
            </div>
        <div class="table-container">    
            <table id="diverttable">

                <tr>
                    <!--Hospital name, Trauma, Xray, Cathlab, CT, Notes-->
                    <th>Hospital</th> <!--Hospital-->
                    <th data-status>Trauma</th> <!--Trauma-->
                    <th data-status>ICU</th> <!--ICU-->
                    <th data-status>X-ray</th> <!--X-ray-->
                    <th data-status>Cath-lab</th> <!-- Cath Lab-->
                    <th data-status>CT</th> <!-- CT-->
                    <th>Notes</th> <!--Notes-->
                </tr>
                <!--Table heading above, hospitals below-->
                <tr>
                    <td>Saraland Freestanding ED</td> <!--Hospital-->
                    <td>Clear</td> <!--Trauma-->
                    <td>N/A</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>University Hospital</td>
                    <td>TSO</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Mobile Infirmary</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Springhill Hospital</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>University Hospital Freestanding ED</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>N/A</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Providence</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>

         </table>
        </div>
        function fetchTableData() {
    fetch("http://127.0.0.1:5000/get_table")
        .then(response => response.json())
        .then(data => {
            const table = document.getElementById('diverttable');

            // Remove all rows except the header
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            // Insert new rows
            data.tableData.forEach(row => {
                const tr = document.createElement('tr');

                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });

                table.appendChild(tr);
            });

            // Reapply diversion coloring
            updateDiversionRows();
        })
        .catch(error => console.error("Error fetching table data:", error));
}
<script>
function updateDiversionRows() {
  const table = document.getElementById("diverttable");
  if (!table || table.rows.length < 2) return;

  // Find status columns from header
  const headerCells = table.rows[0].cells;
  const statusCols = [];
  for (let c = 0; c < headerCells.length; c++) {
    if (headerCells[c].hasAttribute("data-status")) {
      statusCols.push(c);
    }
  }

  // Process each hospital row
  for (let r = 1; r < table.rows.length; r++) {
    const row = table.rows[r];
    let hasAlert = false;

    statusCols.forEach(c => {
      const cell = row.cells[c];
      if (!cell) return;

      const value = cell.textContent.trim().toUpperCase();

      // Anything other than CLEAR or N/A triggers an alert
      if (value !== "CLEAR" && value !== "N/A" && value !== "") {
        hasAlert = true;
      }
    });

    row.classList.remove("row-alert");

    if (hasAlert) {
      row.classList.add("row-alert");
    }
  }
}

// Run on load
window.addEventListener("load", updateDiversionRows);

// Re-run automatically (perfect for Flask / XML refreshes)
setInterval(updateDiversionRows, 1000);
</script>
        <script src="js/divert.js"></script>

    </body>