<!DOCTYPE html>
 <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width-device-width, initial-scare=1">
        <title>Hospital Diversion Status</title>
        <link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/divert.css" rel="stylesheet"/>
        <script src="js/bootstrap.bundle.js"></script>
    </head>

    <body>
        <div id="header">
            <header>
                <div class="container">
                    <div class="row">
                     <div class="col-xxlg-6">
                         <div id="header">
                          <h1>Medic Mate</h1>
                          </div>
                         </div>
                    </div>
            </header>
            </div>
            <div class="container">
                <div class="row">
            <ul class="nav justify-content-center">
                <ul class="nav nav-tabs">
                    <li class="nav item">
                        <a class="nav-link"
                        href="index.html">Home</a>
                    </li>
                    <li class="nav item">
                        <a class="nav-link"
                        href="calculators.html">Calculators</a>
                    </li>
                    <li class="nav item">
                <a class="nav-link"
                href="directory.html">Hospital Directory</a>
                 </li>
            <li class="nav item">
                <a class="nav-link"
                href="about.html">About Us</a>
            </li>
                    </ul>   
                </ul>
             </div>
            </div>
        <div class="table-container">    
            <table id="diverttable">

                <tr>
                    <!--Hospital name, Trauma, Xray, Cathlab, CT, Notes-->
                    <th>Hospital</th> <!--Hospital-->
                    <th data-status>Trauma</th> <!--Trauma-->
                    <th data-status>ICU</th> <!--ICU-->
                    <th data-status>X-ray</th> <!--X-ray-->
                    <th data-status>Cath-lab</th> <!-- Cath Lab-->
                    <th data-status>CT</th> <!-- CT-->
                    <th>Notes</th> <!--Notes-->
                </tr>
                <!--Table heading above, hospitals below-->
                <tr>
                    <td>Saraland Freestanding ED</td> <!--Hospital-->
                    <td>Clear</td> <!--Trauma-->
                    <td>N/A</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>University Hospital</td>
                    <td>TSO</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Mobile Infirmary</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Springhill Hospital</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>University Hospital Freestanding ED</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>N/A</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>
                <tr>
                    <td>Providence</td>
                    <td>Clear</td> <!--Trauma-->
                    <td>Clear</td> <!--ICU-->
                    <td>Clear</td> <!--X-ray-->
                    <td>Clear</td> <!-- Cath Lab-->
                    <td>Clear</td> <!-- CT-->
                    <td>Notes</td> <!--Notes-->
                </tr>

         </table>
        </div>
        <script>
            function fetchTableData() {
                fetch("http://127.0.0.1:5000/get_table")  // Fetch updated table data from Flask
                    .then(response => response.json())
                    .then(data => {
                        const table = document.getElementById('editable-table');
                        const tbody = table.querySelector('tbody');
                        tbody.innerHTML = ""; // Clear table
        
                        data.tableData.forEach(row => {
                            let tr = document.createElement('tr');
                            row.forEach(cell => {
                                let td = document.createElement('td');
                                td.textContent = cell;  // Display text (not input fields)
                                tr.appendChild(td);
                            });
                            tbody.appendChild(tr);
                        });
                    })
                    .catch(error => console.error("Error fetching table data:", error));
            }
        
            window.onload = fetchTableData;  // Fetch latest data when page loads
        </script>
<script>
function updateDiversionColors() {
  const table = document.getElementById("diverttable");
  if (!table || table.rows.length < 2) return;

  // Determine which columns are status columns from the header
  const headerCells = table.rows[0].cells;
  const statusCols = [];
  for (let c = 0; c < headerCells.length; c++) {
    if (headerCells[c].hasAttribute("data-status")) statusCols.push(c);
  }

  // Apply coloring for each data row
  for (let r = 1; r < table.rows.length; r++) {
    const row = table.rows[r];

    statusCols.forEach(c => {
      const cell = row.cells[c];
      if (!cell) return;

      const value = cell.textContent.trim().toUpperCase();

      cell.classList.remove("status-alert");

      // Treat CLEAR and N/A as OK; everything else is alert
      if (value !== "CLEAR" && value !== "N/A" && value !== "") {
        cell.classList.add("status-alert");
      }
    });
  }
}

// Run on load and after updates
window.addEventListener("load", updateDiversionColors);

// If your Flask fetch replaces table contents, call updateDiversionColors() after it runs too.
// As a fallback, re-check periodically:
setInterval(updateDiversionColors, 1000);
</script>
        <script src="js/divert.js"></script>

    </body>