<!DOCTYPE html>
 <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width-device-width, initial-scare=1">
        <title>Hospital Diversion Status</title>
        <link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/divert.css" rel="stylesheet"/>
        <script src="js/bootstrap.bundle.js"></script>
    </head>

    <body>
        <div id="header">
    <h1>Medic Mate</h1>
  </div>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
    <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Home</a>

    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#mainNav"
      aria-controls="mainNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <!-- <li class="nav-item"><a class="nav-link" href="calculators.html">Calculators</a></li> -->
        <!-- Optional dropdown for “Calculators” -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="calculatorsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Calculators
          </a>
          <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="calculatorsDropdown">
            <li><a class="dropdown-item" href="burn.html">Burn Calculator</a></li>
            <li><a class="dropdown-item" href="drugcalc.html">Drug Calculator</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="emsa.html">EMSA Score</a></li>
            <li><a class="dropdown-item" href="gcs.html">GCS Calculator</a></li>
            <li><a class="dropdown-item" href="weight.html">Ideal Body Weight Calculator</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="directory.html">Hospital Directory</a></li>
        <li class="nav-item"><a class="nav-link active" href="divert.html">Diversion</a></li>
        <li class="nav-item"><a class="nav-link" href="protocols.html">Protocols</a></li>
        <li class="nav-item"><a class="nav-link" href="worksheet.html">Call Worksheet</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html">Admin Login</a></li>
        
        </ul>
        </div>
    </div>
    </nav>
  <table id="diverttable">
    <thead>
      <tr>
        <th>Hospital</th>
        <th data-status>Trauma</th>
        <th data-status>ICU</th>
        <th data-status>X-ray</th>
        <th data-status>Cath-lab</th>
        <th data-status>CT</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>


        <!-- <script>
        function fetchTableData() {
    fetch("http://127.0.0.1:5000/get_table")
        .then(response => response.json())
        .then(data => {
            const table = document.getElementById('diverttable');

            // Remove all rows except the header
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            // Insert new rows
            data.tableData.forEach(row => {
                const tr = document.createElement('tr');

                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });

                table.appendChild(tr);
            });

            // Reapply diversion coloring
            updateDiversionRows();
        })
        .catch(error => console.error("Error fetching table data:", error));
}
</script>
<script>
function updateDiversionRows() {
  const table = document.getElementById("diverttable");
  if (!table || table.rows.length < 2) return;

  const headerCells = table.rows[0].cells;
  const statusCols = [];
  let notesCol = -1;

  // Detect status columns + notes column from header text
  for (let c = 0; c < headerCells.length; c++) {
    const headerText = headerCells[c].textContent.trim().toUpperCase();

    if (headerCells[c].hasAttribute("data-status")) statusCols.push(c);
    if (headerText === "NOTES") notesCol = c;
  }

  for (let r = 1; r < table.rows.length; r++) {
    const row = table.rows[r];

    let hasAlert = false;
    let hasDelayed = false;

    // Check status columns: anything other than CLEAR/N/A triggers alert
    for (const c of statusCols) {
      const cell = row.cells[c];
      if (!cell) continue;

      const value = cell.textContent.trim().toUpperCase();
      if (value !== "CLEAR" && value !== "N/A" && value !== "") {
        hasAlert = true;
        break;
      }
    }

    // Check notes for "delayed" (only matters if no alert)
    if (!hasAlert && notesCol !== -1) {
      const notesCell = row.cells[notesCol];
      const notesText = (notesCell?.textContent || "").toLowerCase();
      if (notesText.includes("delayed")) {
        hasDelayed = true;
      }
    }

    row.classList.remove("row-alert", "row-warning");

    if (hasAlert) row.classList.add("row-alert");
    else if (hasDelayed) row.classList.add("row-warning");
  }
}

window.addEventListener("load", updateDiversionRows);
setInterval(updateDiversionRows, 1000);
</script> -->

        <script>
async function fetchHospitalData() {
  const res = await fetch("hospitals.json", { cache: "no-store" });
  if (!res.ok) throw new Error("Could not load data/hospitals.json");
  return await res.json();
}

function buildTableRows(hospitals) {
  const table = document.getElementById("diverttable");
  const tbody = table.querySelector("tbody");
  tbody.innerHTML = "";

  hospitals.forEach(h => {
    const tr = document.createElement("tr");

    const cells = [
      h.name,
      h.trauma,
      h.icu,
      h.xray,
      h.cathlab,
      h.ct,
      h.notes
    ];

    cells.forEach(value => {
      const td = document.createElement("td");
      td.textContent = value ?? "";
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });
}

function updateDiversionRows() {
  const table = document.getElementById("diverttable");
  if (!table) return;

  const headerCells = table.querySelectorAll("thead th");
  const statusCols = [];
  let notesCol = -1;

  headerCells.forEach((th, idx) => {
    if (th.hasAttribute("data-status")) statusCols.push(idx);
    if (th.textContent.trim().toUpperCase() === "NOTES") notesCol = idx;
  });

  const rows = table.querySelectorAll("tbody tr");

  rows.forEach(row => {
    const tds = row.querySelectorAll("td");

    let hasAlert = false;
    let hasDelayed = false;

    // Red if any status col is not CLEAR/N/A
    for (const c of statusCols) {
      const value = (tds[c]?.textContent || "").trim().toUpperCase();
      if (value !== "CLEAR" && value !== "N/A" && value !== "") {
        hasAlert = true;
        break;
      }
    }

    // Yellow if notes contains "delayed" (only if not already red)
    if (!hasAlert && notesCol !== -1) {
      const notes = (tds[notesCol]?.textContent || "").toLowerCase();
      if (notes.includes("delayed")) hasDelayed = true;
    }

    row.classList.remove("row-alert", "row-warning");
    if (hasAlert) row.classList.add("row-alert");
    else if (hasDelayed) row.classList.add("row-warning");
  });
}

async function loadAndRender() {
  try {
    const data = await fetchHospitalData();
    buildTableRows(data.hospitals || []);
    updateDiversionRows();
  } catch (err) {
    console.error(err);
  }
}

window.addEventListener("load", loadAndRender);

// Optional: auto-refresh (works, but note GitHub Pages caching can still apply sometimes)
setInterval(loadAndRender, 30_000); // every 30 seconds
</script>

        <script src="js/divert.js"></script>

    </body>
